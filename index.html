<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Ввод данных по проектам</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 16px; }
    table { border-collapse: collapse; margin-bottom: 12px; width: 100%; max-width: 1200px; }
    table, th, td { border: 1px solid #008000; }
    th, td { padding: 6px; }
    input { width: 140px; }
    .actions { margin-bottom: 12px; }
    .actions button { margin-right: 6px; padding: 6px 10px; cursor: pointer; }
  </style>
</head>
<body>
  <h2>Ввод данных по проектам</h2>

  <table id="projectsTable">
    <tr>
      <th>Название объекта</th>
      <th>Дата начала проекта</th>
      <th>Дата конца проекта</th>
      <th>Сумма контракта</th>
      <th>Дата аванса</th>
      <th>% аванса</th>
      <th>Понижение (%)</th>
    </tr>
    <tr>
      <td><input type="text" placeholder="Проект 1" /></td>
      <td><input type="date" /></td>
      <td><input type="date" /></td>
      <td><input type="number" placeholder="₽" step="0.01" /></td>
      <td><input type="date" /></td>
      <td><input type="number" placeholder="%" step="0.01" /></td>
      <td><input type="number" placeholder="%" step="0.01" /></td>
    </tr>
  </table>

  <div class="actions">
    <button id="btnAdd">Добавить проект</button>
    <button id="btnGoChart">Построить график</button>
    <button id="btnClear">Очистить данные</button>
  </div>

  <script>
    function attachListeners(row) {
      row.querySelectorAll('input').forEach(inp => {
        inp.addEventListener('input', saveTableData);
      });
    }

    function saveTableData() {
      const rows = Array.from(document.querySelectorAll('#projectsTable tr')).slice(1);
      const data = rows.map(r => Array.from(r.querySelectorAll('input')).map(i => i.value || ''));
      localStorage.setItem('projectsData', JSON.stringify(data));
    }

    function loadTableData() {
      const saved = localStorage.getItem('projectsData');
      const table = document.getElementById('projectsTable');
      while (table.rows.length > 1) table.deleteRow(1);
      if (!saved) { addRow(); return; }
      let data = [];
      try { data = JSON.parse(saved); if (!Array.isArray(data)) data = []; } catch { data = []; }
      if (data.length === 0) { addRow(); return; }
      data.forEach(rowData => {
        const row = table.insertRow();
        for (let i = 0; i < 7; i++) {
          const cell = row.insertCell();
          const input = document.createElement('input');
          if (i === 0) input.type = 'text';
          if ([1, 2, 4].includes(i)) input.type = 'date';
          if ([3, 5, 6].includes(i)) { input.type = 'number'; input.step = '0.01'; }
          input.value = rowData[i] || '';
          cell.appendChild(input);
        }
        attachListeners(row);
      });
    }

    function addRow() {
      const row = document.getElementById('projectsTable').insertRow();
      for (let i = 0; i < 7; i++) {
        const cell = row.insertCell();
        const input = document.createElement('input');
        if (i === 0) input.type = 'text';
        if ([1, 2, 4].includes(i)) input.type = 'date';
        if ([3, 5, 6].includes(i)) { input.type = 'number'; input.step = '0.01'; }
        cell.appendChild(input);
      }
      attachListeners(row);
      saveTableData();
    }

    function clearData() {
      localStorage.removeItem('projectsData');
      const table = document.getElementById('projectsTable');
      while (table.rows.length > 1) table.deleteRow(1);
      addRow();
    }

    document.getElementById('btnAdd').addEventListener('click', addRow);
    document.getElementById('btnClear').addEventListener('click', clearData);
    document.getElementById('btnGoChart').addEventListener('click', () => {
      saveTableData();
      window.location.href = 'chart.html';
    });

    loadTableData();
  </script>
</body>
</html>
